<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.kosmo.travary.service.impl.touristspot.PopularityMapper">
	<select id="selectTop5ByRegion" resultType="map" parameterType="map">
		SELECT * FROM 
		(SELECT name,region,lat,lnt
		FROM tourist_spot s JOIN 
		(SELECT SUM(JAN+FEB+MAR+APR+MAY+JUN+JUL+AUG+SEP+OCT+NOV+DEC) 
		as total,no FROM tourist_spot_popularity GROUP BY NO) p
		ON s.no=p.no WHERE region=#{region} ORDER BY total desc)
		WHERE rownum &lt;=5
	</select>
	<insert id="saveByNo" parameterType="map" >
		INSERT INTO tourist_spot_popularity VALUES( #{no} ,
		<choose>
			<when test="JAN != null"> #{JAN} </when>
			<otherwise>DEFAULT</otherwise>
		</choose>,
		<choose>
			<when test="FEB != null">#{FEB}</when>
			<otherwise>DEFAULT</otherwise>
		</choose>,
		<choose>
			<when test="MAR != null">#{MAR}</when>
			<otherwise>DEFAULT</otherwise>
		</choose>,
		<choose>
			<when test="APR != null">#{APR}</when>
			<otherwise>DEFAULT</otherwise>
		</choose>,
		<choose>
			<when test="MAY != null">#{MAY}</when>
			<otherwise>DEFAULT</otherwise>
		</choose>,
		<choose>
			<when test="JUN != null">#{JUN}</when>
			<otherwise>DEFAULT</otherwise>
		</choose>,
		<choose>
			<when test="JUL != null">#{JUL}</when>
			<otherwise>DEFAULT</otherwise>
		</choose>,
		<choose>
			<when test="AUG != null">#{AUG}</when>
			<otherwise>DEFAULT</otherwise>
		</choose>,
		<choose>
			<when test="SEP != null">#{SEP}</when>
			<otherwise>DEFAULT</otherwise>
		</choose>,
		<choose>
			<when test="OCT != null">#{OCT}</when>
			<otherwise>DEFAULT</otherwise>
		</choose>,
		<choose>
			<when test="NOV != null">#{NOV}</when>
			<otherwise>DEFAULT</otherwise>
		</choose>,
		<choose>
			<when test="DEC != null">#{DEC}</when>
			<otherwise>DEFAULT</otherwise>
		</choose>)
	</insert>
	<select id="findFourByNo" resultType="String" parameterType="map" >
	<!-- SELECT NAME FROM tourist_spot WHERE no IN (#{no},#{no}+1,#{no}+2,#{no}+3) -->
	SELECT NAME FROM tourist_spot WHERE no IN (#{no},#{no}+1,#{no}+2,#{no}+3)
	</select>
	<select id="find" resultType="int" >
		SELECT * FROM LASTNUM
	</select>
	<update id="updateLastNum" parameterType="map">
		UPDATE lastnum SET no=#{no} WHERE no > 0
	</update>
</mapper>